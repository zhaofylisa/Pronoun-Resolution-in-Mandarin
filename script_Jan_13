// Remove command prefix
PennController.ResetPrefix(null);


//DebugOff()
Sequence("consent","intro","background","intro-2","ex1-instructions","1.1 training-v2","endTrain-1", randomize("1.2 prior-v2"),"send","ex2-instructions", randomize('2.1 training'),"endTrain-2", randomize("2.2 likelihood") ,"send","ex3-instructions", randomize("3.1 training"),"endTrain-3",randomize("3.2 posterior") ,"send","debrief","send","completion_screen")
//Sequence("consent","background","intro","intro-2");
//uncomment for experiment 1 - version2
//Sequence("ex1-instructions","1.1 training-v2","endTrain-1", randomize("1.2 prior-v2") )

//uncomment for experiment 2
//Sequence("ex2-instructions", randomize('2.1 training'),"endTrain-2", randomize("2.2 likelihood") )

//uncomment for experiment 3
//Sequence("ex3-instructions", randomize("3.1 training"),"endTrain-3",randomize("3.2 posterior") )


// consent form
newTrial("consent",
    newHtml("consent_form","consent.html")
        .cssContainer({"width":"720px"})
        .checkboxWarning("ç»§ç»­å®éªŒå‰è¯·å…ˆå‹¾é€‰åŒæ„ã€‚")
        .print()
    ,
    newButton("continue", "ç‚¹å‡»ç»§ç»­")
        .center()
        .print()
        .wait(getHtml("consent_form").test.complete()
                  .failure(getHtml("consent_form").warn())
        )
);

// background form
newTrial("background",
    newHtml("background","background.html")
        .cssContainer({"width":"720px"})
        .checkboxWarning("å¼€å§‹å®éªŒå‰è¯·å…ˆå®Œæ•´å›ç­”é—®å·ã€‚")
        .log()
        .print()
    ,
    newButton("continue", "ç‚¹å‡»ç»§ç»­")
        .center()
        .print()
        .wait(getHtml("background").test.complete()
                  .failure(getHtml("background").warn())
        )
).log("ID", getVar("ID"))
;

//Intro
newTrial("intro",
        newText("Hello! æ¬¢è¿æ‚¨å‚åŠ å®éªŒğŸ‰")
            .bold()
            .center()
            .print()
        ,
        newText("<p>æœ¬æ¬¡å®éªŒåˆ†ä¸ºä¸‰é¡¹ä»»åŠ¡ï¼š</p>")
            .center()
            .print()
        ,
        newText("<b>ä»»åŠ¡1. é€‰æ‹©å›¾ç‰‡æ¥è¡¥å……ä¸å®Œæ•´åœºæ™¯ã€‚</b>")
            .center()
            .print()
        ,
        newText("<b>ä»»åŠ¡2. æ ¹æ®å›¾ç‰‡å†…å®¹ï¼Œé€‰æ‹©ä»£è¯æ¥è¡¥å……ä¸å®Œæ•´å¥å­ã€‚</b>")
            .center()
            .print()
        ,
        newText("<b>ä»»åŠ¡3. æ ¹æ®å¥å­ï¼Œé€‰æ‹©å›¾ç‰‡æ¥å›ç­”é—®é¢˜ã€‚</b>")
            .center()
            .print()
        ,
        newText("<p>æ¯é¡¹ä»»åŠ¡å¼€å§‹å‰ä¼šè¿›è¡Œä»‹ç»å¹¶æä¾›è®­ç»ƒæ¨¡å¼ï¼ŒæŒ‰ç…§æŒ‡ç¤ºæ“ä½œå³å¯ :)</p>")
            .center()
            .print()
        ,
        newText("<pæœ‰äº›æƒ…å†µä¸‹æ²¡æœ‰å”¯ä¸€ç­”æ¡ˆï¼Œä¸åŒäººä¼šæœ‰ä¸ä¸€æ ·çš„ç›´è§‰ï¼Œè¿™æ˜¯ååˆ†æ­£å¸¸çš„:) </p>")
            .center()
            .print()
        ,
        newText("è¯·æ ¹æ®æ‚¨çš„ç›´è§‰åŠæ—¥å¸¸ä¹ æƒ¯è¿›è¡Œé€‰æ‹©ã€‚")
            .center()
            .print()
        ,
        newText("<p>è¯·ä½¿ç”¨ç”µè„‘å®Œæˆå®éªŒï¼Œå»ºè®®ä½¿ç”¨Chrome, Firefox, æˆ–Safariæµè§ˆå™¨ã€‚")
            .center()
            .print()
        ,
        newText("å®éªŒæ—¶é•¿å¤§çº¦20-30åˆ†é’Ÿï¼Œå®éªŒä¸€æ—¦ä¸­æ–­åˆ™æ— æ³•ç»§ç»­è¿›è¡Œã€‚")
            .center()
            .print()
        ,
        newText("å±å¹•é¡¶éƒ¨ä¼šæ˜¾ç¤ºå®éªŒè¿›ç¨‹ï¼Œ<b>è¯·å…¨ç¨‹ä¿æŒä¸“æ³¨</b>ã€‚")
            .center()
            .print()
        ,
        newText("æ‚¨çš„ä»»åŠ¡è¡¨ç°å¯èƒ½ä¼šå½±å“æ‚¨çš„æœ€ç»ˆæŠ¥é…¬ï¼Œè¯·è®¤çœŸå®Œæˆå®éªŒä»»åŠ¡ã€‚</p>")
            .center()
            .print()
        ,
        newText("instructions-6", "è¯·è¾“å…¥æ‚¨æ”¯ä»˜å®è´¦å·ï¼ˆç”¨äºè½¬è´¦ï¼Œè¯·å†æ¬¡æ ¸å¯¹æ­£ç¡®ï¼‰:")
            .cssContainer({"margin-bottom":"1em"})
            .center()
            .print()
        ,
        newTextInput("input_ID")
            .cssContainer({"margin-bottom":"1em"})
            .log("final")
            .center()
            .print()
       ,
       newText("instructions", "è¯·è¾“å…¥å¯è”ç³»åˆ°æ‚¨çš„é‚®ç®±:")
            .cssContainer({"margin-bottom":"1em"})
            .center()
            .print()
        ,
        newTextInput("email")
            .cssContainer({"margin-bottom":"1em"})
            .log("final")
            .center()
            .print()
       ,
       newText("å®éªŒæ­£å¼å¼€å§‹å‰ï¼Œè¯·å…ˆå¡«å†™ä¸€ä»½è¯­è¨€èƒŒæ™¯çš„è°ƒæŸ¥é—®å·ã€‚</p>")
            .center()
            .print()
        ,
        newButton("wait", "ç‚¹å‡»å¡«å†™èƒŒæ™¯é—®å·")
            .center()
            .print()
            .wait()
        ,
        newVar("ID")
            .global()
            .set(getTextInput("input_ID"))
        ,
        newVar("Email")
            .global()
            .set(getTextInput("email"))
)

// introduction to the character
newTrial('intro-2',
    newText("äººç‰©ä»‹ç»")
        .bold()
        .css("font-size", "1.5em")
        .center()
        .print()
    ,
    newText("instructions-1", "<p>å®éªŒè¿‡ç¨‹ä¸­æ‚¨å°†ç»å¸¸é‡è§ä»¥ä¸‹å››ä½äººç‰©ï¼š</p>")
        .center()
        .print()
    ,
    newImage("w1", "wanggang.png")
        .size(150,150)
    ,
    newImage("w2", "lihua.png")
        .size(150,150)
    ,
    newImage("w3", "xiaoming.png")
        .size(150,150)
    ,
    newImage("w4", "other.png")
        .size(150,150)
    ,
    newCanvas('worlds', 650, 250)
        .add( 0, 50, getImage('w1') )
        .add( 160, 50, getImage('w2'))
        .add( 320, 50, getImage('w3'))
        .add( 480, 50, getImage('w4'))
        .center()
        .print()
    ,
    newText("instructions-2", "<p>è¯·æ³¨æ„ï¼šä»–ä»¬<b>æ²¡æœ‰</b>å›ºå®šçš„äººè®¾ã€‚<br>å®éªŒä¸­æ¯ä¸ªå¥å­ä¸­çš„äººç‰©éƒ½æ˜¯ç‹¬ç«‹å­˜åœ¨ï¼Œä¸ä¸Šä¸‹å¥æ— å…³ã€‚</p>")
        .center()
        .print()
    ,
    newButton("wait", "ç‚¹å‡»å¼€å§‹å®éªŒ")
        .center()
        .print()
        .wait()
);



//1. prior experiment - select picture
// Instructions
newTrial("ex1-instructions",
    newText("instructions-1", "ä»»åŠ¡ä¸€")
        .bold()
        .css("font-size", "1.5em")
        .center()
        .print()
    ,
    newText("ï¼ˆæ¬¢è¿æ¬¢è¿ ğŸ‘ï¼‰")
        .bold()
        .center()
        .print()
    ,
    newText("instructions-2", "<p>åœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæ‚¨å°†ä¼šçœ‹åˆ°ä¸€ä¸ªä¸å®Œæ•´çš„åœºæ™¯ä»¥åŠä¸‰å¼ äººç‰©å›¾ç‰‡ã€‚æ‚¨éœ€è¦ï¼š</p>")
        .center()
        .print()
    ,
    newText("instructions-3", "<b> 1. é¦–å…ˆé˜…è¯»åœºæ™¯åŠç©ºç¼ºéƒ¨åˆ† ğŸ“– </b>")
        .print()
    ,
    newText("instructions-4", "<b> 2. æ ¹æ®æ‚¨çš„ç›´è§‰ğŸ’¡ï¼Œ<b style='color:Blue;'> é¼ æ ‡ç‚¹å‡» </b>ï¼Œåœ¨ä¸‰ä¸ªäººç‰©ä¸­é€‰æ‹©ä¸€ä¸ªè¡¥å……ç¼ºå°‘éƒ¨åˆ†ï¼Œè®©åœºæ™¯æœ€æœ‰å¯èƒ½å‘ç”Ÿï¼Œè¶Šå¿«è¶Šå¥½ï¼Œæ‚¨çš„æŒ‰é”®æ—¶é—´å°†è¢«è®°å½•ã€‚ï¼ˆå°tipï¼šé€‰æ‹©å‰å¯ä»¥å…ˆé—­ä¸Šçœ¼ç›æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼‰</b>")
        .print()
    ,
    newText("instructions-6", "<p>ä¸ç”¨æ‹…å¿ƒï¼Œåœ¨æ­£å¼å¼€å§‹å‰æˆ‘ä»¬ä¼šå…ˆç»™æ‚¨å±•ç¤ºä¸€ä¸ªèŒƒä¾‹ã€‚èŒƒä¾‹å°†æ¨¡æ‹Ÿå—è¯•è€…çš„å†…å¿ƒæ´»åŠ¨ï¼Œè§£é‡Šé€‰æ‹©èƒŒåçš„åŸå› ã€‚åœ¨å®éªŒè¿‡ç¨‹ä¸­å°†æŒç»­ç»™æœ‰æŒ‡ç¤ºï¼ŒæŒ‰ç…§æŒ‡ç¤ºæ“ä½œå³å¯ :)  </p>")
        .center()
        .print()
    ,
    newText("<p>æ‚¨çš„ä»»åŠ¡è¡¨ç°å¯èƒ½ä¼šå½±å“æ‚¨çš„æœ€ç»ˆæŠ¥é…¬ï¼Œè¯·è®¤çœŸå®Œæˆå®éªŒä»»åŠ¡ã€‚</p>")
            .center()
            .print()
    ,
    newButton("wait", " æŸ¥çœ‹èŒƒä¾‹ ")
        .center()
        .print()
        .wait()
)

//1.1 training - version2
newTrial("1.1 training-v2",
    newText(" èŒƒä¾‹ ")
        .bold()
        .css("border", "solid 1px black")
        .center()
        .print()
    ,
    newText('s1',"   </p> &nbspï¼šâ€œ")
        .bold()
        .css("font-size", "1.6em")
        .before( newImage("wanggang.png").size(90) )

    ,
    newText("s2", '<br><br>&nbspæŠŠ<font color = red>&nbsp &nbsp?&nbsp &nbsp</font>çš„æ¯å­æ‰“ç¢äº† â€')
        .center()
        .bold()
        .css("font-size", "1.6em")
    ,
    newImage("lihua.png")
        .size(90,90)
        .before(getText('s1'))
        .after(getText('s2'))
        .center()
        .print()
    ,
    newText(" -----------------------------------------------------------------------------------------------------------").center().print()
    ,
    newText("question", "è¯·é€‰æ‹©ï¼šä»¥ä¸‹ä¸‰ä¸ªäººç‰©ä¸­ï¼Œå“ªä¸ªäººç‰©<font color = red>æœ€æœ‰å¯èƒ½</font>è¢«è¡¥å……åˆ° <font color = red>?</font> å¤„, ä½¿å¾—ä»¥ä¸Šåœºæ™¯æœ€æœ‰å¯èƒ½å‘ç”Ÿï¼Ÿ")
        .bold()
        .center()
        .print()
    ,
    newText("ï¼ˆå°tipï¼šé€‰æ‹©å‰å¯ä»¥å…ˆé—­ä¸Šçœ¼ç›æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼‰")
        .bold()
        .center()
        .print()
    ,
    newText("instruction", "<br>è¯·<b style='color:Blue;'> ç”¨é¼ æ ‡<b>ä¾æ¬¡ç‚¹å‡»</b></b> ä¸‰ä¸ªäººç‰©æŸ¥çœ‹é€‰æ‹©èƒŒåçš„åŸå› ã€‚")
        .center()
        .print()
    ,
    newText("feedback")
    ,
    newImage("w1", "wanggang.png")
        .size(200,200)
    ,
    newImage("w2", "lihua.png")
        .size(200,200)
    ,
    newImage("w3", "other.png")
        .size(200,200)
    ,
    newText("pleasewait", "</br>è¯·å…ˆæ€è€ƒ2ç§’â€¦â€¦")
        .center()
        .print()
    ,
    newTimer("wait", 2000)
        .start()
        .wait()
    ,
    getText("pleasewait")
        .remove()
    ,
    newCanvas( 'worlds', 700, 450)
        .add( 0, 50, getImage('w1') )
        .add( 250, 50, getImage('w2'))
        .add( 500, 50, getImage('w3'))
        .center()
        .print()
    ,
    newSelector("world")
        .add( getImage("w1") , getImage("w2"), getImage("w3") )
        .log("all")
    ,
    getSelector("world")
        .callback(
            getSelector("world")
                .test.selected(getImage("w2")).success( 
                    getText("feedback")
                            .text("<p>é€‰ã€æåã€‘æ˜¯å› ä¸ºæˆ‘çš„ç¬¬ä¸€ç›´è§‰ä¸ºä»¥ä¸‹æƒ…æ™¯ï¼š</p> æœ‰äººé—®ç‹åˆšä¸ºä»€ä¹ˆé€æåä¸€ä¸ªæ¯å­ï¼Œç‹åˆšè§£é‡Šé“ï¼šâ€œå› ä¸ºæåæŠŠæåè‡ªå·±çš„æ¯å­æ‰“ç¢äº†ã€‚â€")
                            .color("red")
                            .center()
                            .print(150,250,"worlds")
                            
                )
                .test.selected(getImage("w1")).success(
                    getText("feedback")
                        .text("<p>é€‰ã€ç‹åˆšã€‘æ˜¯å› ä¸ºæˆ‘çš„ç¬¬ä¸€ç›´è§‰ä¸ºä»¥ä¸‹æƒ…æ™¯ï¼š</p>æœ‰äººé—®ç‹åˆšä¸ºä»€ä¹ˆè¦å»ä¹°æ¯å­ï¼Œç‹åˆšè§£é‡Šé“ï¼šâ€œå› ä¸ºæåæŠŠæˆ‘çš„æ¯å­æ‰“ç¢äº†ã€‚æˆ‘å»è¶…å¸‚ä¹°ä¸ªæ–°çš„ã€‚â€")
                        .color("red")
                        .center()
                        .print(150,250,"worlds")
                    
                )
                .test.selected(getImage("w3")).success(
                    getText("feedback")
                        .text("<p>é€‰ã€å…¶ä»–äººã€‘æ˜¯å› ä¸ºæˆ‘çš„ç¬¬ä¸€ç›´è§‰ä¸ºä»¥ä¸‹æƒ…æ™¯ï¼š</p>ç‹åˆšå’Œå®¶äººåœ¨å®¶é‡Œå–èŒ¶æ—¶ï¼ŒæŸä¸€å®¶äººæ²¡æœ‰æ‰¾åˆ°æ¯å­ï¼Œç‹åˆšè§£é‡Šé“ï¼šâ€œæåæŠŠä½ çš„æ¯å­æ‰“ç¢äº†ï¼Œæˆ‘å†å»ç»™ä½ æ‹¿ä¸€ä¸ªã€‚â€")
                        .color("red")
                        .center()
                        .print(150,250,"worlds")
                    
                )
        )
    ,
    getSelector("world").wait()
    ,
    newText("ä½ æƒ³è±¡ä¸­çš„åœºæ™¯æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ")
        .bold()
        .center()
        .print(180,360,"worlds")
    ,
    newText("button","ä¸‰ä¸ªäººç‰©éƒ½æŸ¥çœ‹å®Œåï¼Œè¯·ç‚¹å‡» ")
    ,
    newButton("wait", " æˆ‘äº†è§£äº†")
        .center()
        .bold()
        .css("font-size", "1.1em")
        .before(getText("button"))
        .after(newText("ç»“æŸèŒƒä¾‹ã€‚"))
        .print(150,400,"worlds")
        .log()
        .wait()
)

//end training
newTrial("endTrain-1",
    newText("ä»»åŠ¡ä¸€")
            .bold()
            .css("font-size", "1.5em")
            .center()
            .print()
    ,
    newText("<p> èŒƒä¾‹ç»“æŸ! </p>")
        .bold()
        .css("font-size", "2em")
        .center()
        .print()
    ,
    newText("<p>é©¬ä¸Šå¼€å§‹æ­£å¼ä»»åŠ¡ï¼Œæ­£å¼ä»»åŠ¡ä¸­å°†<b>ä¸ä¼š</b>æœ‰èŒƒä¾‹ä¸­å‡ºç°çš„åé¦ˆã€‚</p>")
        .center()
        .print()
    ,
    newText("<p>ä¸åŒäººä¼šæœ‰ä¸ä¸€æ ·çš„ç›´è§‰ï¼Œè¿™æ˜¯ååˆ†æ­£å¸¸çš„:) æ ¹æ®æ‚¨çš„ç›´è§‰åŠæ—¥å¸¸ä¹ æƒ¯è¿›è¡Œé€‰æ‹©å³å¯ã€‚")
        .center()
        .print()
    ,
    newText("ä¸ºä¿è¯æ‚¨åœ¨è®¤çœŸç­”é¢˜ï¼Œ<b>æœ‰å”¯ä¸€ç­”æ¡ˆ</b>çš„åœºæ™¯ä½ éœ€è¦å›ç­”æ­£ç¡®ã€‚è¯·ä»”ç»†é˜…è¯»æ¯ä¸€ä¸ªåœºæ™¯ã€‚</p>")
            .center()
            .bold()
            .color("red")
            .print()
    ,
    newText("<p>åœ¨å®éªŒè¿‡ç¨‹ä¸­å°†æŒç»­ç»™æœ‰æŒ‡ç¤ºï¼ŒæŒ‰ç…§æŒ‡ç¤ºæ“ä½œå³å¯ã€‚</p>")
        .center()
        .print()
    ,
    newButton("wait", " æ­£å¼å¼€å§‹å§ï¼")
        .center()
        .print()
        .wait()
)

//1.2 version2
// instead of the name of the character, here we use the pictures of the character
Template("item1.csv",
    row => newTrial( "1.2 prior-v2" ,
        newTimer("break", 1000)
            .start()
            .wait()
        ,
        newImage("W1", row.W1)
            .size(200,200)
        ,
        newImage("W2", row.W2)
            .size(200,200)
        ,
        newImage("W3", row.W3)
            .size(200,200)
        ,
        newText('s1',"&nbsp ï¼šâ€œ ")
            .bold()
            .css("font-size", "1.6em")
            .before( newImage(row.W1).size(90,90) )
        ,
        newText("s2", "<br><br>&nbsp"+row.sentence2 + 'â€')
            .center()
            .bold()
            .css("font-size", "1.6em")
        ,
        newImage(row.W2)
            .size(90,90)
            .before(getText('s1'))
            .after(getText('s2'))
            .center()
            .print()
        ,
        newText(" -----------------------------------------------------------------------------------------------------------").center().print()
        ,
        newText("question", "è¯·é€‰æ‹©ï¼šä»¥ä¸‹ä¸‰ä¸ªäººç‰©ä¸­ï¼Œå“ªä¸ªäººç‰©æœ€æœ‰å¯èƒ½è¢«è¡¥å……åˆ° ? å¤„ï¼Œä½¿å¾—ä»¥ä¸Šåœºæ™¯æœ€æœ‰å¯èƒ½å‘ç”Ÿï¼Ÿ")
            .bold()
            .color("red")
            .center()
            .print()
        ,
        newText("ï¼ˆå°tipï¼šé€‰æ‹©å‰å¯ä»¥å…ˆé—­ä¸Šçœ¼ç›æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼‰")
            .bold()
            .color("red")
            .center()
            .print()
        ,
        newText("instruction", "è¯·<b style='color:Blue;'> ç”¨é¼ æ ‡<b>ç‚¹å‡»</b></b> é€‰æ‹©ã€‚<b>è¶Šå¿«è¶Šå¥½</b>ï¼ŒæŒ‰é”®æ—¶é—´å°†è¢«è®°å½•ã€‚")
            .center()
            .print()
        ,
        newText("pleasewait", "</br>è¯·å…ˆæ€è€ƒ2ç§’â€¦â€¦")
            .center()
            .print()
        ,
        newTimer("wait", 2000)
            .start()
            .wait()
        ,
        getText("pleasewait")
            .remove()
        ,
        newCanvas( 'worlds', 700, 350)
            .add( 0, 50, getImage('W1') )
            .add( 250, 50, getImage('W2'))
            .add( 500, 50, getImage('W3'))
            .center()
            .print()
        ,
        newSelector("world")
            .add( getImage("W1") , getImage("W2"),getImage("W3") )
            .shuffle()
            .log()
            .wait()
    )
    .log("ID", getVar("ID"))
    .log("Email", getVar("Email"))
    .log("experiment", row.experiment)
    .log("senID", row.senID)
    .log("item", row.item)
    .log("type", row.type)
    .log("sentence", row.sentence)
);



//2. likelihood experiment - dropdown 

// 2.0 instruction
newTrial("ex2-instructions",
    newText("instructions-1", "ä»»åŠ¡äºŒ")
        .bold()
        .css("font-size", "1.5em")
        .center()
        .print()
    ,
    newText("ï¼ˆåŠ æ²¹åŠ æ²¹ ğŸ‘ï¼‰")
        .bold()
        .center()
        .print()
    ,
    newText("instructions-2", "<p>åœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæ‚¨å°†ä¼šçœ‹åˆ°ä¸€ä¸ªä¸å®Œæ•´çš„å¥å­ä»¥åŠä¸€å¼ äººç‰©å›¾ç‰‡ï¼Œ<font color = red>è¿™ä¸ªäººç‰©å°±æ˜¯å¥å­ç¼ºå°‘çš„éƒ¨åˆ†</font>ã€‚æ‚¨éœ€è¦ï¼š</p>")
        .center()
        .print()
    ,
    newText("instructions-3", "<b> 1. é˜…è¯»å¥å­ï¼Œå›¾ç‰‡äººç‰©æ˜¯å¥å­ç¼ºå°‘éƒ¨åˆ†ï¼Œé€šè¿‡å›¾ç‰‡ç†è§£å¥å­æ„æ€ ğŸ“–ã€‚</b>")
        .print()
    ,
    newText("instructions-4", "<b> 2. åœ¨ä¸‹æ‹‰æ¡†ä¸­ï¼Œé€‰æ‹©é€‚å½“çš„<font color = red>ä»£è¯</font>ï¼Œä¸å›¾æ„ç›¸ç¬¦ä¸”ç¬¦åˆä¸­æ–‡è¯­æ³•ã€‚è¶Šå¿«è¶Šå¥½ï¼Œæ‚¨çš„é€‰æ‹©æ—¶é—´å°†è¢«è®°å½•ã€‚</b>")
        .print()
    ,
    newText("instructions-5", "<b> 3. æœ‰äº›æƒ…å†µä¸‹å¹¶æ²¡æœ‰å”¯ä¸€ç­”æ¡ˆï¼Œä¸åŒäººä¼šæœ‰ä¸ä¸€æ ·çš„ç›´è§‰ï¼Œè¿™æ˜¯ååˆ†æ­£å¸¸çš„:) ç›¸ä¿¡æ‚¨çš„ç¬¬ä¸€ç›´è§‰åŠæ—¥å¸¸ä¹ æƒ¯ï¼Œé€‰æ‹©<font color = red>æœ€é¡ºå£</font>é‚£ä¸ªã€‚</b>")
        .print()
    ,
    newText("instructions-7", "<p>é¦–å…ˆæ‚¨å°†è¿›å…¥ç»ƒä¹ æ¨¡å¼ã€‚ç»ƒä¹ æ¨¡å¼å†…å«æœ‰äº”ä¸ªå¥å­ï¼Œå…¶ç›®çš„ä¸ºç†Ÿæ‚‰ä»»åŠ¡æµç¨‹ã€‚ç»ƒä¹ æ¨¡å¼ç»“æŸåä¼šè¿›å…¥æ­£å¼ä»»åŠ¡ã€‚ </p>")
        .center()
        .print()
    ,
    newText("<p>æ‚¨çš„ä»»åŠ¡è¡¨ç°å¯èƒ½ä¼šå½±å“æ‚¨çš„æœ€ç»ˆæŠ¥é…¬ï¼Œè¯·è®¤çœŸå®Œæˆå®éªŒä»»åŠ¡ã€‚</p>")
            .center()
            .print()
    ,
    newButton("wait", " è¿›å…¥ç»ƒä¹ æ¨¡å¼")
        .center()
        .print()
        .wait()
)

//2.1 training
Template("item2-train.csv",
    row => newTrial( "2.1 training" ,
        newTimer("break", 1000)
            .start()
            .wait()
        ,
        newText(" è®­ç»ƒæ¨¡å¼ ")
        .bold()
        .css("border", "solid 1px black")
        .center()
        .print()
        ,
        newText("instruct","<br>å›¾ä¸­çš„äººç‰©ä»£è¡¨å¥å­ç¼ºå°‘çš„äººç‰©ã€‚")
            
            .color("red")
            .center()
            .print()
        ,
        newText("instruct-2","è¯·æ ¹æ®æ‚¨çš„ç›´è§‰åŠæ—¥å¸¸ä¹ æƒ¯ï¼Œé€‰æ‹©<font color = red>ä¸å›¾ä¸­äººç‰©ç›¸ç¬¦çš„ä»£è¯</font>æ¥å®Œæ•´å¥å­ã€‚")
            .bold()
            .center()
            .print()
        ,
        
        newText("<br><b>ï¼ˆå°tipï¼šè¡¥å……å®Œåå¯ä»¥è¯»ä¸€éï¼Œæ˜¯å¦ä¸å›¾æ„ç›¸ç¬¦ï¼Ÿæ˜¯å¦é€šé¡ºï¼Ÿ</b>ï¼‰")
                .center()
                .print()
        ,
        
        newText("<p> -----------------------------------------------------------------------------------------------------------</p>").center().print()
        ,
        newDropDown("pronouns", "")
            .add('ä»–','ä»–è‡ªå·±','è‡ªå·±', row.op4)
            .shuffle()
            .before(newText("sentence", row.sentence + " ")
                .bold()
                .css("font-size", "1.8em"))
            .after(newText("sentence2", " " + row.sentence2 )
                .bold()
                .css("font-size", "1.8em"))
            .center()
            .bold()
            .css("font-size", "1.5em")
            .log()
            .print()
        ,
        newText('</p>').print()
        ,
        newImage("trueworld", row.ans)
            .size(300,300)
            .center()
            .print()
        ,
        getDropDown("pronouns")
            .wait()
        ,
        newButton("next", "Next")
            .center()
            .bold()
            .css("font-size", "1em")
            .print(880,390)
            .wait()
    )
    .log("ID", getVar("ID"))
    .log("Email", getVar("Email"))
    .log("experiment", row.experiment)
    .log("item", row.item)
    .log("sentence", row.sentence)
    .log("sentence2", row.sentence2)
);

newTrial("endTrain-2",
    newText("ä»»åŠ¡äºŒ")
            .bold()
            .css("font-size", "1.5em")
            .center()
            .print()
    ,
    newText("<p> è®­ç»ƒæ¨¡å¼ç»“æŸ! </p>")
        .bold()
        .css("font-size", "2em")
        .center()
        .print()
    ,
    newText("<p>é©¬ä¸Šå¼€å§‹æ­£å¼ä»»åŠ¡ï¼Œæœ‰äº›æƒ…å†µ<b>å¹¶æ²¡æœ‰å”¯ä¸€ç­”æ¡ˆ</b>ï¼Œæ ¹æ®æ‚¨çš„ç›´è§‰åŠæ—¥å¸¸ä¹ æƒ¯è¿›è¡Œé€‰æ‹©å³å¯ã€‚</p>")
        .center()
        .print()
    ,
    newText("<p>è¶Šå¿«è¶Šå¥½ï¼Œæ‚¨çš„é€‰æ‹©æ—¶é—´å°†è¢«è®°å½•ã€‚</p>")
        .color("blue")
        .center()
        .print()
    ,
    newText("è¯·ä»”ç»†é˜…è¯»æ¯ä¸€ä¸ªå¥å­ã€‚ä¸ºä¿è¯æ‚¨åœ¨è®¤çœŸç­”é¢˜ï¼Œ<b>æœ‰å”¯ä¸€ç­”æ¡ˆ</b>çš„åœºæ™¯ä½ éœ€è¦å›ç­”æ­£ç¡®ã€‚</p>")
            .center()
            .bold()
            .color("red")
            .print()
    ,
    newText("<p>ä¸ç”¨æ‹…å¿ƒï¼Œåœ¨å®éªŒè¿‡ç¨‹ä¸­å°†æŒç»­ç»™æœ‰æŒ‡ç¤ºï¼ŒæŒ‰ç…§æŒ‡ç¤ºæ“ä½œå³å¯:) </p>")
        .center()
        .print()
    ,
    newButton("wait", " æ­£å¼å¼€å§‹å§ï¼")
        .center()
        .print()
        .wait()
)


//2.2 start experiment
Template("item2.csv",
    row => newTrial( "2.2 likelihood" ,
        newTimer("break", 1000)
            .start()
            .wait()
        ,
        newText("instruct","<br>å›¾ä¸­çš„äººç‰©ä»£è¡¨å¥å­ç¼ºå°‘çš„äººç‰©ã€‚")
            .color("red")
            .center()
            .print()
        ,
        newText("instruct-2","è¯·æ ¹æ®æ‚¨çš„ç›´è§‰åŠæ—¥å¸¸ä¹ æƒ¯ï¼Œé€‰æ‹©<font color = red>ä¸å›¾ä¸­äººç‰©ç›¸ç¬¦çš„ä»£è¯æ¥å®Œæ•´å¥å­</font>ã€‚")
            .bold()
            .center()
            .print()
        ,
        
        newText("<br><b>ï¼ˆå°tipï¼šè¡¥å……å®Œåå¯ä»¥è¯»ä¸€éï¼Œæ˜¯å¦ä¸å›¾æ„ç›¸ç¬¦ï¼Ÿæ˜¯å¦é€šé¡ºï¼Ÿ</b>ï¼‰")
                .center()
                .print()
        ,
        
        newText("<p> -----------------------------------------------------------------------------------------------------------</p>").center().print()
        ,
        newDropDown("pronouns", "")
            .add('ä»–','ä»–è‡ªå·±','è‡ªå·±',row.op4)
            .shuffle()
            .before(newText("sentence", row.sentence + ' ')
                .bold()
                .css("font-size", "1.8em"))
            .after(newText("sentence2", " " + row.sentence2 )
                .bold()
                .css("font-size", "1.8em"))
            .center()
            .bold()
            .css("font-size", "1.5em")
            .log()
            .print()
        ,
        newText('</p>').print()
        ,
        newImage("trueworld", row.world)
            .size(300,300)
            .center()
            .print()
        ,
        getDropDown("pronouns")
            .wait()
        ,
        newButton("next", "Next")
            .center()
            .bold()
            .css("font-size", "1.1em")
            .print(850,370)
            .wait()
    )
    .log("ID", getVar("ID"))
    .log("Email", getVar("Email"))
    .log("Group", row.Group)
    .log("experiment", row.experiment)
    .log("senID", row.senID)
    .log("item", row.item)
    .log("type", row.type)
    .log("condition", row.condition)
    .log("sentence", row.sentence)
    .log("sentence2", row.sentence2)
);

// 3. posterior experiment
// Instructions
newTrial("ex3-instructions",
    newText("instructions-1", "ä»»åŠ¡ä¸‰")
        .bold()
        .css("font-size", "1.5em")
        .center()
        .print()
    ,
    newText("ï¼ˆæœ€åä¸€é¡¹ä»»åŠ¡äº†ï¼ŒåŠ æ²¹ ğŸ’ªï¼‰")
        .bold()
        .center()
        .print()
    ,
    newText("instructions-2", "<p>åœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæ‚¨å°†ä¼šçœ‹åˆ°ä¸€ä¸ªå¥å­ï¼Œä¸€ä¸ªé—®é¢˜ï¼Œä»¥åŠä¸‰å¼ äººç‰©å›¾ç‰‡ã€‚æ‚¨éœ€è¦ï¼š</p>")
        .center()
        .print()
    ,
    newText("instructions-3", "<b>1. é¦–å…ˆé˜…è¯»å¥å­ ğŸ“–ï¼ˆå°tipï¼šå¯ä»¥è¯»å‡ºå£°æ¥ï¼‰ </b>")
        .print()
    ,
    newText("instructions-4", "<b>2. æ ¹æ®å¥å­å’Œæ‚¨çš„ç›´è§‰ï¼Œè¿…é€Ÿæ€è€ƒé—®é¢˜ç­”æ¡ˆåğŸ’¡ï¼ŒæŒ‰<b style='color:Blue;'> ç©ºæ ¼é”® </b>ç»§ç»­ï¼Œè¶Šå¿«è¶Šå¥½ï¼Œæ‚¨çš„æŒ‰é”®æ—¶é—´å°†è¢«è®°å½•ã€‚</b>")
        .print()
    ,
    newText("instructions-5", "<b>3. åœ¨æ¥ä¸‹æ¥å‡ºç°çš„ä¸‰å¼ å›¾ä¸­ï¼Œç”¨<b style='color:Blue;'> é¼ æ ‡ç‚¹å‡» </b>é€‰æ‹©æ‚¨å¿ƒä¸­çš„ç­”æ¡ˆ âœ…ï¼Œè¶Šå¿«è¶Šå¥½ï¼Œæ‚¨çš„é€‰æ‹©æ—¶é—´å°†è¢«è®°å½•ã€‚</b>")
        .print()
    ,
    newText("<p>æœ‰äº›æƒ…å†µä¸‹æ²¡æœ‰å”¯ä¸€ç­”æ¡ˆï¼Œä¸åŒäººä¼šæœ‰ä¸ä¸€æ ·çš„ç›´è§‰ï¼Œè¿™æ˜¯ååˆ†æ­£å¸¸çš„:) ")
            .center()
            .print()
    ,
    newText("è¯·æ ¹æ®æ‚¨çš„ç›´è§‰åŠæ—¥å¸¸ä¹ æƒ¯è¿›è¡Œé€‰æ‹©ã€‚")
        .center()
        .print()
    ,
    newText("instructions-7", "<p>é¦–å…ˆæ‚¨å°†åŠ å…¥<b>ç»ƒä¹ æ¨¡å¼</b>ï¼Œå®Œæˆåå¼€å§‹æ­£å¼ä»»åŠ¡ã€‚ç»ƒä¹ æ¨¡å¼å†…å«æœ‰äº”ä¸ªå¥å­ï¼Œå…¶ç›®çš„ä¸ºç†Ÿæ‚‰ä»»åŠ¡æµç¨‹ï¼Œå› æ­¤æ‚¨é€‰æ‹©å®Œæ¯•åä¼šç»™å‡ºåé¦ˆã€‚ä½†æ˜¯ï¼Œæ­£å¼ä»»åŠ¡ä¸­å°†ä¸ä¼šæœ‰ä»»ä½•åé¦ˆã€‚</p>")
        .center()
        .print()
    ,
    newText("<p>æ‚¨çš„ä»»åŠ¡è¡¨ç°å¯èƒ½ä¼šå½±å“æ‚¨çš„æœ€ç»ˆæŠ¥é…¬ï¼Œè¯·è®¤çœŸå®Œæˆå®éªŒä»»åŠ¡ã€‚</p>")
            .center()
            .print()
    ,
    newButton("wait", " è¿›å…¥ç»ƒä¹ æ¨¡å¼ ")
        .center()
        .print()
        .wait()
)
//3.1 training - 5 trial
Template("item3-train.csv",
row => 
    newTrial("3.1 training",
        newTimer("break", 1000)
                .start()
                .wait()
        ,
        newVar("correct")
            .log("set")
        ,
        newText(" è®­ç»ƒæ¨¡å¼ ")
        .bold()
        .css("border", "solid 1px black")
        .center()
        .print()
        ,
        newText("feedback")
        ,
        newText("sentence", row.sentence)
                    .bold()
                    .css("font-size", "2em")
                    .center()
                    .print()
        ,
        newTimer("wait", 10000)
            .start()
        ,
        newText("question", "</p>" + row.question)
            .bold()
            .css("font-size", "1.2em")
            .before(newText("</p> é—®é¢˜ï¼š").css("font-size", "1.2em"))
            .color("red")
            .center()
            .print()
        ,
        newText("instruction", "</p> è¯·å…ˆæ€è€ƒï¼Œç„¶åè¿…é€ŸæŒ‰ <b style='color:Blue;'> ç©ºæ ¼é”®</b> ç»§ç»­ï¼Œè¶Šå¿«è¶Šå¥½ï¼ŒæŒ‰é”®æ—¶é—´å°†è¢«è®°å½•ã€‚")
            .center()
            .print()
        ,
        newKey("space", " ")
            .callback( getTimer("wait").stop() )
            .log()
        ,
        getTimer("wait")
            .wait()
        ,
        //  getText("sentence")
        //     .remove()
        // ,
        getText("instruction")
            .remove()
        ,
        newText("</p> è¯·ç”¨<b style='color:Blue;'> é¼ æ ‡ç‚¹å‡» </b> é€‰æ‹© ")
            .center()
            .print()
        ,
        newImage("op1", row.option1)
            .size(200,200)
            //.print()
        ,
        newImage("ans", row.answer)
            .size(200,200)
            //.before( getImage("W1") )
        ,
        newImage("op3", row.option3)
            .size(200,200)
            //.before( getImage("W2") )
            //.print()
        ,
        newCanvas( 'worlds', 700, 200)
            .add( 0, 50, getImage('op1') )
            .add( 250, 50, getImage('ans'))
            .add( 500, 50, getImage('op3'))
            .center()
            .print()
        ,
        newSelector("world")
            .add( getImage("op1") , getImage("ans"), getImage("op3") )
            .shuffle()
            .once()
            .log()
            .wait()
        ,
        getSelector("world")
            .test.selected(getImage("ans"))
            .success( 
                getText("feedback")
                    .text("æ­£ç¡®ï¼æŒ‰ç©ºæ ¼é”®ç»§ç»­")
                    .color('red')
                    .center()
                    .print(280,300,"worlds")
                ,
                getVar("correct")
                    .set(true)
            )
            .failure( 
                getText("feedback")
                    .text("é”™è¯¯!")
                    .after(newText(row.feedback).color("red"))
                    .after(newText("</p> æŒ‰ç©ºæ ¼é”®ç»§ç»­").color("red"))
                    .color("red")
                    .center()
                    .print(280,300,"worlds")
                ,
                getVar("correct")
                    .set(false)
                )
        ,
        newTimer("post-trial", 3000).start()
        ,
        newKey(" ")
            .callback( getTimer("post-trial").stop() )
            .log()
        ,
        getTimer("post-trial")
            .wait()

    )
    .log("experiment", row.experiment)
    .log("sentence", row.sentence)
    .log("item", row.item)
    .log("Correct", getVar("correct"))
    .log("ID", getVar("ID"))
    .log("Email", getVar("Email"))
)

newTrial("endTrain-3",
    newText("ä»»åŠ¡ä¸‰")
            .bold()
            .css("font-size", "1.5em")
            .center()
            .print()
    ,
    newText("<p> è®­ç»ƒæ¨¡å¼ç»“æŸ! </p>")
        .bold()
        .css("font-size", "2em")
        .center()
        .print()
    ,
    newText("<p>é©¬ä¸Šå¼€å§‹æ­£å¼ä»»åŠ¡ï¼Œæ­£å¼ä»»åŠ¡ä¸­å°†<b>ä¸ä¼š</b>æœ‰ç»ƒä¹ æ¨¡å¼ä¸­å‡ºç°çš„åé¦ˆã€‚åŒæ—¶å¯èƒ½å‡ºç°<b>æ¨¡æ£±ä¸¤å¯</b>çš„æƒ…å†µã€‚</p>")
        .center()
        .print()
    ,
    newText("<p>ä¸åŒäººä¼šæœ‰ä¸ä¸€æ ·çš„ç›´è§‰ï¼Œè¿™æ˜¯ååˆ†æ­£å¸¸çš„:) ")
            .center()
            .print()
    ,
    newText("è¯·æ ¹æ®æ‚¨çš„ç¬¬ä¸€ç›´è§‰åŠæ—¥å¸¸ä¹ æƒ¯è¿›è¡Œé€‰æ‹©ã€‚</p>")
        .center()
        .print()
    ,
    newText("è¯·ä»”ç»†é˜…è¯»æ¯ä¸€ä¸ªå¥å­ã€‚ä¸ºä¿è¯æ‚¨åœ¨è®¤çœŸç­”é¢˜ï¼Œ<b>æœ‰å”¯ä¸€ç­”æ¡ˆ</b>çš„åœºæ™¯ä½ éœ€è¦å›ç­”æ­£ç¡®ã€‚</p>")
            .center()
            .bold()
            .color("red")
            .print()
    ,
    newText("<p>ä¸ç”¨æ‹…å¿ƒï¼Œåœ¨å®éªŒè¿‡ç¨‹ä¸­å°†æŒç»­ç»™æœ‰æŒ‡ç¤ºï¼ŒæŒ‰ç…§æŒ‡ç¤ºæ“ä½œå³å¯:) </p>")
        .center()
        .print()
    ,
    newButton("wait", " æ­£å¼å¼€å§‹å§ï¼")
        .center()
        .print()
        .wait()
)
 


//3.2 start
// show the sentence and give participants several seconds to think about the answer
Template("item3.csv",
    row => newTrial( "3.2 posterior" ,
        newTimer("break", 1000)
            .start()
            .wait()
        ,
        newText("sentence", row.sentence)
            .bold()
            .css("font-size", "2em")
            .center()
            .print()
        ,
        newTimer("wait", 15000)
            .start()
        ,
        newText("question", "</p>" + row.question)
            .bold()
            .css("font-size", "1.2em")
            .before(newText("</p> é—®é¢˜ï¼š").css("font-size", "1.2em"))
            .color("red")
            .center()
            .print()
        ,
        newText("instruction", "</p> è¯·å…ˆæ€è€ƒï¼Œç„¶åè¿…é€ŸæŒ‰ <b style='color:Blue;'> ç©ºæ ¼é”®</b> ç»§ç»­ï¼Œè¶Šå¿«è¶Šå¥½æŒ‰é”®æ—¶é—´å°†è¢«è®°å½•ã€‚")
            .center()
            .print()
        ,
        newKey("space", " ")
            .callback( getTimer("wait").stop() )
            .log()
        ,
        getTimer("wait")
            .wait()
        ,
        //  getText("sentence")
        //     .remove()
        // ,
         getText("instruction")
            .remove()
        ,
        newText("</p> è¯·ç”¨<b style='color:Blue;'> é¼ æ ‡ç‚¹å‡» </b> é€‰æ‹© ")
            .center()
            .print()
        ,
        newImage("W1", row.W1)
            .size(200,200)
            //.print()
        ,
        newImage("W2", row.W2)
            .size(200,200)
            //.before( getImage("W1") )
            //.print()
        ,
        newImage("W3", row.W3)
            .size(200,200)
            //.before( getImage("W2") )
            //.print()
        ,
        newCanvas( 'worlds', 700, 200)
            .add( 0, 50, getImage('W1') )
            .add( 250, 50, getImage('W2'))
            .add( 500, 50, getImage('W3'))
            .center()
            .print()
        ,
        newSelector("world")
            .add( getImage("W1") , getImage("W2"),getImage("W3") )
            .shuffle()
            .once()
            .log()
            .wait()
    )
    .log("ID", getVar("ID"))
    .log("experiment", row.experiment)
    .log("senID", row.senID)
    .log("Email", getVar("Email"))
    .log("Group", row.Group)
    .log("item", row.item)
    .log("type", row.type)
    .log("condition",row.condition)
    .log("sentence", row.sentence)
    .log("w1",row.W1)
    .log("w2",row.W2)
    .log("w3",row.W3)
    
);

// debriefing form
newTrial("debrief",
    newHtml("debriefing_form","debrief.html")
        .cssContainer({"width":"720px"})
        .checkboxWarning("ç»“æŸå®éªŒå‰è¯·å›ç­”æœ¬é—®å·ä¸­çš„æ¯ä¸€ä¸ªé—®é¢˜ã€‚")
        .log()
        .print()
    ,
    newButton("continue", "å‘é€å®éªŒæ•°æ®å¹¶ç»“æŸå®éªŒ")
        .center()
        .print()
        .wait(getHtml("debriefing_form").test.complete()
                  .failure(getHtml("debriefing_form").warn())
        )
)
// Send results manually
SendResults("send")

// Completion screen
newTrial("completion_screen",
    newText("thanks", "æ„Ÿè°¢æ‚¨çš„å‚ä¸ï¼æ‚¨çš„æŠ¥é…¬å°†äº15æ—¥å†…è½¬å…¥æ‚¨çš„æ”¯ä»˜å®è´¦å·ã€‚è‹¥æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·è”ç³»ç ”ç©¶äººå‘˜èµµä¸°æ‚¦ï¼ˆzhaofylisa@gmail.comï¼‰ã€‚ç¥æ‚¨ç”Ÿæ´»æ„‰å¿« :) ")
        .center()
        .print()
    ,
    newText(" æ‚¨ç°åœ¨å¯ä»¥å…³é—­æ­¤çª—å£...")
        .center()
        .print()
    ,
    newButton("void", "")
        .wait()
)
